/* Copyright © 2004-2015 Trumba Corporation. All rights reserved. */
if(typeof($Trumba)=="undefined"){try{if(typeof asual=="undefined"){var asual={}}if(typeof asual.util=="undefined"){asual.util={}}asual.util.Browser=new function(){var b=navigator.userAgent.toLowerCase(),a=/webkit/.test(b),f=/opera/.test(b),c=/msie/.test(b)&&!/opera/.test(b),d=/mozilla/.test(b)&&!/(compatible|webkit)/.test(b),g=parseFloat(c?b.substr(b.indexOf("msie")+4):(b.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1]);this.toString=function(){return"[class Browser]"};this.getVersion=function(){return g};this.isMSIE=function(){return c};this.isSafari=function(){return a};this.isOpera=function(){return f};this.isMozilla=function(){return d}};asual.util.Events=new function(){var c="DOMContentLoaded",l="onstop",m=window,j=document,b=[],a=asual.util,f=a.Browser,d=f.isMSIE(),h=f.isSafari();this.toString=function(){return"[class Events]"};this.addListener=function(q,n,p){b.push({o:q,t:n,l:p});if(!(n==c&&(d||h))){if(q.addEventListener){q.addEventListener(n,p,false)}else{if(q.attachEvent){q.attachEvent("on"+n,p)}}}};this.removeListener=function(s,p,q){for(var n=0,r;r=b[n];n++){if(r.o==s&&r.t==p&&r.l==q){b.splice(n,1);break}}if(!(p==c&&(d||h))){if(s.removeEventListener){s.removeEventListener(p,q,false)}else{if(s.detachEvent){s.detachEvent("on"+p,q)}}}};this.removeAllListeners=function(){for(var n=0,p;p=b[n];n++){if(p.o.removeEventListener){p.o.removeEventListener(p.t,p.l,false)}else{if(p.o.detachEvent){p.o.detachEvent("on"+p.t,p.l)}}}b.length=0};var k=function(){for(var p=0,n;n=b[p];p++){if(n.t!=c){a.Events.removeListener(n.o,n.t,n.l)}}};var g=function(){if(j.readyState=="interactive"){function n(){j.detachEvent(l,n);k()}j.attachEvent(l,n);m.setTimeout(function(){j.detachEvent(l,n)},0)}};if(d||h){(function(){try{if((d&&j.body)||!/loaded|complete/.test(j.readyState)){j.documentElement.doScroll("left")}}catch(p){return setTimeout(arguments.callee,0)}for(var n=0,p;p=b[n];n++){if(p.t==c){p.l.call(null)}}})()}if(d){m.attachEvent("onbeforeunload",g)}this.addListener(m,"unload",k)};asual.util.Functions=new function(){this.toString=function(){return"[class Functions]"};this.bind=function(g,b,f){for(var c=2,d,a=[];d=arguments[c];c++){a.push(d)}return function(){return g.apply(b,a)}}};var SWFAddressEvent=function(d){this.toString=function(){return"[object SWFAddressEvent]"};this.type=d;this.target=[SWFAddress][0];this.value=SWFAddress.getValue();this.path=SWFAddress.getPath();this.pathNames=SWFAddress.getPathNames();this.parameters={};var c=SWFAddress.getParameterNames();for(var b=0,a=c.length;b<a;b++){this.parameters[c[b]]=SWFAddress.getParameter(c[b])}this.parameterNames=c};SWFAddressEvent.INIT="init";SWFAddressEvent.CHANGE="change";SWFAddressEvent.INTERNAL_CHANGE="internalChange";SWFAddressEvent.EXTERNAL_CHANGE="externalChange";var SWFAddress=new function(){var _getHash=function(){var index=_l.href.indexOf("#");return index!=-1?_ec(_dc(_l.href.substr(index+1))):""};var _getWindow=function(){try{top.document;return top}catch(e){return window}};var _strictCheck=function(value,force){if(_opts.strict){value=force?(value.substr(0,1)!="/"?"/"+value:value):(value==""?"/":value)}return value};var _ieLocal=function(value,direction){return(_msie&&_l.protocol=="file:")?(direction?_value.replace(/\?/,"%3F"):_value.replace(/%253F/,"?")):value};var _searchScript=function(el){if(el.childNodes){for(var i=0,l=el.childNodes.length,s;i<l;i++){try{if(el.childNodes[i].src){_url=String(el.childNodes[i].src)}if(s=_searchScript(el.childNodes[i])){return s}}catch(e){}}}};var _titleCheck=function(){if(_d.title!=_title&&_d.title.indexOf("#")!=-1){_d.title=_title}};var _listen=function(){if(!_silent){var hash=_getHash();var diff=!(_value==hash);if(_safari&&_version<523){if(_length!=_h.length){_length=_h.length;if(typeof _stack[_length-1]!=UNDEFINED){_value=_stack[_length-1]}_update.call(this,false)}}else{if(_msie&&diff){if(_version<7){_l.reload()}else{this.setValue(hash)}}else{if(diff){_value=hash;_update.call(this,false)}}}if(_msie){_titleCheck.call(this)}}};var _bodyClick=function(e){if(_popup.length>0){var popup=window.open(_popup[0],_popup[1],eval(_popup[2]));if(typeof _popup[3]!=UNDEFINED){eval(_popup[3])}}_popup=[]};var _swfChange=function(){for(var i=0,id,obj,value=SWFAddress.getValue(),setter="setSWFAddressValue";id=_ids[i];i++){obj=document.getElementById(id);if(obj){if(obj.parentNode&&typeof obj.parentNode.so!=UNDEFINED){obj.parentNode.so.call(setter,value)}else{if(!(obj&&typeof obj[setter]!=UNDEFINED)){var objects=obj.getElementsByTagName("object");var embeds=obj.getElementsByTagName("embed");obj=((objects[0]&&typeof objects[0][setter]!=UNDEFINED)?objects[0]:((embeds[0]&&typeof embeds[0][setter]!=UNDEFINED)?embeds[0]:null))}if(obj){obj[setter](value)}}}else{if(obj=document[id]){if(typeof obj[setter]!=UNDEFINED){obj[setter](value)}}}}};var _jsDispatch=function(type){this.dispatchEvent(new SWFAddressEvent(type));type=type.substr(0,1).toUpperCase()+type.substr(1);if(typeof this["on"+type]==FUNCTION){this["on"+type]()}};var _jsInit=function(){if(_util.Browser.isSafari()){_d.body.addEventListener("click",_bodyClick)}_jsDispatch.call(this,"init")};var _jsChange=function(){_swfChange();_jsDispatch.call(this,"change")};var _update=function(internal){_jsChange.call(this);if(internal){_jsDispatch.call(this,"internalChange")}else{_jsDispatch.call(this,"externalChange")}_st(_functions.bind(_track,this),10)};var _track=function(){};var _htmlWrite=function(){var doc=_frame.contentWindow.document;doc.open();doc.write("<html><head><title>"+_d.title+"</title><script>var "+ID+' = "'+_getHash()+'";<\/script></head></html>');doc.close()};var _htmlLoad=function(){var win=_frame.contentWindow;var src=win.location.href;_value=(typeof win[ID]!=UNDEFINED?win[ID]:"");if(_value!=_getHash()){_update.call(SWFAddress,false);_l.hash=_ieLocal(_value,TRUE)}};var _canAccessLocation=function(){try{_l.href}catch(e){return false}return true};var _load=function(){if(!_canAccessLocation()){_supported=false;return}if(!_loaded){_loaded=TRUE;if(_msie&&_version<8){var framesetCollection=_d.getElementsByTagName("frameset");var frameset=framesetCollection[framesetCollection.length-1];_frame=_d.createElement((frameset?"":"i")+"frame");if(frameset){frameset.insertAdjacentElement("beforeEnd",_frame);frameset[frameset.cols?"cols":"rows"]+=",0";_frame.src="javascript:false";_frame.noResize=true;_frame.frameBorder=_frame.frameSpacing=0}else{_frame.src="javascript:false";_frame.style.display="none";_d.body.insertAdjacentElement("afterBegin",_frame)}_st(function(){_events.addListener(_frame,"load",_htmlLoad);if(typeof _frame.contentWindow[ID]==UNDEFINED){_htmlWrite()}},50)}else{if(_safari){if(_version<418){_d.body.innerHTML+='<form id="'+ID+'" style="position:absolute;top:-9999px;" method="get"></form>';_form=_d.getElementById(ID)}if(typeof _l[ID]==UNDEFINED){_l[ID]={}}if(typeof _l[ID][_l.pathname]!=UNDEFINED){_stack=_l[ID][_l.pathname].split(",")}}}_st(_functions.bind(function(){_jsInit.call(this);_jsChange.call(this);_track.call(this)},this),1);if(_msie&&_version>=8){_d.body.onhashchange=_functions.bind(_listen,this);_si(_functions.bind(_titleCheck,this),50)}else{_si(_functions.bind(_listen,this),50)}}};var ID="swfaddress",FUNCTION="function",UNDEFINED="undefined",TRUE=true,FALSE=false,_util=asual.util,_browser=_util.Browser,_events=_util.Events,_functions=_util.Functions,_version=_browser.getVersion(),_msie=_browser.isMSIE(),_mozilla=_browser.isMozilla(),_opera=_browser.isOpera(),_safari=_browser.isSafari(),_supported=FALSE,_t=_getWindow(),_d=_t.document,_h=_t.history,_l=_t.location,_si=setInterval,_st=setTimeout,_dc=decodeURI,_ec=encodeURI,_frame,_form,_url,_title=_d.title,_length=_h.length,_silent=FALSE,_loaded=FALSE,_justset=TRUE,_juststart=TRUE,_ref=this,_stack=[],_ids=[],_popup=[],_listeners={},_value=_getHash(),_opts={history:TRUE,strict:TRUE};if(_msie&&_d.documentMode&&_d.documentMode!=_version){_version=_d.documentMode!=8?7:8}_supported=(_mozilla&&_version>=1)||(_msie&&_version>=6)||(_opera&&_version>=9.5)||(_safari&&_version>=312);if(_supported){_supported=_canAccessLocation()}if(_supported){if(_opera){history.navigationMode="compatible"}for(var i=1;i<_length;i++){_stack.push("")}_stack.push(_getHash());if(_msie&&_l.hash!=_getHash()){_l.hash="#"+_ieLocal(_getHash(),TRUE)}_searchScript(document);var _qi=_url?_url.indexOf("?"):-1;if(_qi!=-1){var param,params=_url.substr(_qi+1).split("&");for(var i=0,p;p=params[i];i++){param=p.split("=");if(/^(history|strict)$/.test(param[0])){_opts[param[0]]=(isNaN(param[1])?/^(true|yes)$/i.test(param[1]):(parseInt(param[1])!=0))}if(/^tracker$/.test(param[0])){_opts[param[0]]=param[1]}}}if(_msie){_titleCheck.call(this)}if(window==_t){_events.addListener(document,"DOMContentLoaded",_functions.bind(_load,this))}_events.addListener(_t,"load",_functions.bind(_load,this))}this.disable=function(){_events.removeAllListeners();_supported=false};this.toString=function(){return"[class SWFAddress]"};this.back=function(){_h.back()};this.forward=function(){_h.forward()};this.up=function(){var path=this.getPath();this.setValue(path.substr(0,path.lastIndexOf("/",path.length-2)+(path.substr(path.length-1)=="/"?1:0)))};this.go=function(delta){_h.go(delta)};this.href=function(url,target){target=typeof target!=UNDEFINED?target:"_self";if(target=="_self"){self.location.href=url}else{if(target=="_top"){_l.href=url}else{if(target=="_blank"){window.open(url)}else{_t.frames[target].location.href=url}}}};this.popup=function(url,name,options,handler){try{var popup=window.open(url,name,eval(options));if(typeof handler!=UNDEFINED){eval(handler)}}catch(ex){}_popup=arguments};this.getIds=function(){return _ids};this.getId=function(index){return _ids[0]};this.setId=function(id){_ids[0]=id};this.addId=function(id){this.removeId(id);_ids.push(id)};this.removeId=function(id){for(var i=0;i<_ids.length;i++){if(id==_ids[i]){_ids.splice(i,1);break}}};this.addEventListener=function(type,listener){if(typeof _listeners[type]==UNDEFINED){_listeners[type]=[]}_listeners[type].push(listener)};this.removeEventListener=function(type,listener){if(typeof _listeners[type]!=UNDEFINED){for(var i=0,l;l=_listeners[type][i];i++){if(l==listener){break}}_listeners[type].splice(i,1)}};this.dispatchEvent=function(event){if(this.hasEventListener(event.type)){event.target=this;for(var i=0,l;l=_listeners[event.type][i];i++){l(event)}return TRUE}return FALSE};this.hasEventListener=function(type){return(typeof _listeners[type]!=UNDEFINED&&_listeners[type].length>0)};this.getBaseURL=function(){var url=_l.href;if(url.indexOf("#")!=-1){url=url.substr(0,url.indexOf("#"))}if(url.substr(url.length-1)=="/"){url=url.substr(0,url.length-1)}return url};this.getStrict=function(){return _opts.strict};this.setStrict=function(strict){_opts.strict=strict};this.getHistory=function(){return _opts.history};this.setHistory=function(history){_opts.history=history};this.getTracker=function(){return _opts.tracker};this.setTracker=function(tracker){_opts.tracker=tracker};this.getTitle=function(){return _d.title};this.setTitle=function(title){if(!_supported){return null}if(typeof title==UNDEFINED){return}if(title=="null"){title=""}title=_dc(title);_st(function(){_title=_d.title=title;if(_juststart&&_frame&&_frame.contentWindow&&_frame.contentWindow.document){_frame.contentWindow.document.title=title;_juststart=FALSE}if(!_justset&&_mozilla){_l.replace(_l.href.indexOf("#")!=-1?_l.href:_l.href+"#")}_justset=FALSE},10)};this.getStatus=function(){return _t.status};this.setStatus=function(status){if(!_supported){return null}if(typeof status==UNDEFINED){return}if(status=="null"){status=""}status=_dc(status);if(!_safari){status=_strictCheck((status!="null")?status:"",TRUE);if(status=="/"){status=""}if(!(/http(s)?:\/\//.test(status))){var index=_l.href.indexOf("#");status=(index==-1?_l.href:_l.href.substr(0,index))+"#"+status}_t.status=status}};this.resetStatus=function(){_t.status=""};this.getValue=function(){if(!_supported){return null}return _dc(_strictCheck(_ieLocal(_value,FALSE),FALSE))};this.setValue=function(value){if(!_supported){return null}if(typeof value==UNDEFINED){return}if(value=="null"){value=""}value=_ec(_dc(_strictCheck(value,TRUE)));if(value=="/"){value=""}if(_value==value){return}_justset=TRUE;_value=value;_silent=TRUE;_update.call(SWFAddress,true);_stack[_h.length]=_value;if(_safari){if(_opts.history){_l[ID][_l.pathname]=_stack.toString();_length=_h.length+1;if(_version<418){if(_l.search==""){_form.action="#"+_value;_form.submit()}}else{if(_version<523||_value==""){var evt=_d.createEvent("MouseEvents");evt.initEvent("click",TRUE,TRUE);var anchor=_d.createElement("a");anchor.href="#"+_value;anchor.dispatchEvent(evt)}else{_l.hash="#"+_value}}}else{_l.replace("#"+_value)}}else{if(_value!=_getHash()){if(_opts.history){_l.hash="#"+_dc(_ieLocal(_value,TRUE))}else{_l.replace("#"+_dc(_value))}}}if((_msie&&_version<8)&&_opts.history){_st(_htmlWrite,50)}if(_safari){_st(function(){_silent=FALSE},1)}else{_silent=FALSE}};this.getPath=function(){var value=this.getValue();if(value.indexOf("?")!=-1){return value.split("?")[0]}else{if(value.indexOf("#")!=-1){return value.split("#")[0]}else{return value}}};this.getPathNames=function(){var path=this.getPath(),names=path.split("/");if(path.substr(0,1)=="/"||path.length==0){names.splice(0,1)}if(path.substr(path.length-1,1)=="/"){names.splice(names.length-1,1)}return names};this.getQueryString=function(){var value=this.getValue(),index=value.indexOf("?");if(index!=-1&&index<value.length){return value.substr(index+1)}};this.getParameter=function(param){var value=this.getValue();var index=value.indexOf("?");if(index!=-1){value=value.substr(index+1);var p,params=value.split("&"),i=params.length,r=[];while(i--){p=params[i].split("=");if(p[0]==param){r.push(p[1])}}if(r.length!=0){return r.length!=1?r:r[0]}}};this.getParameterNames=function(){var value=this.getValue();var index=value.indexOf("?");var names=[];if(index!=-1){value=value.substr(index+1);if(value!=""&&value.indexOf("=")!=-1){var params=value.split("&"),i=0;while(i<params.length){names.push(params[i].split("=")[0]);i++}}}return names};this.onInit=null;this.onChange=null;this.onInternalChange=null;this.onExternalChange=null;(function(){var _args;if(typeof FlashObject!=UNDEFINED){SWFObject=FlashObject}if(typeof SWFObject!=UNDEFINED&&SWFObject.prototype&&SWFObject.prototype.write){var _s1=SWFObject.prototype.write;SWFObject.prototype.write=function(){_args=arguments;if(this.getAttribute("version").major<8){this.addVariable("$swfaddress",SWFAddress.getValue());((typeof _args[0]=="string")?document.getElementById(_args[0]):_args[0]).so=this}var success;if(success=_s1.apply(this,_args)){_ref.addId(this.getAttribute("id"))}return success}}if(typeof swfobject!=UNDEFINED){var _s2r=swfobject.registerObject;swfobject.registerObject=function(){_args=arguments;_s2r.apply(this,_args);_ref.addId(_args[0])};var _s2c=swfobject.createSWF;swfobject.createSWF=function(){_args=arguments;var swf=_s2c.apply(this,_args);if(swf){_ref.addId(_args[0].id)}return swf};var _s2e=swfobject.embedSWF;swfobject.embedSWF=function(){_args=arguments;if(typeof _args[8]==UNDEFINED){_args[8]={}}if(typeof _args[8].id==UNDEFINED){_args[8].id=_args[1]}_s2e.apply(this,_args);_ref.addId(_args[8].id)}}if(typeof UFO!=UNDEFINED){var _u=UFO.create;UFO.create=function(){_args=arguments;_u.apply(this,_args);_ref.addId(_args[0].id)}}if(typeof AC_FL_RunContent!=UNDEFINED){var _a=AC_FL_RunContent;AC_FL_RunContent=function(){_args=arguments;_a.apply(this,_args);for(var i=0,l=_args.length;i<l;i++){if(_args[i]=="id"){_ref.addId(_args[i+1])}}}}})()}}catch(e){}window.$Trumba={version:3,loadTime:new Date(),emptyFunction:function(){},baseUri:"",loaderUri:"s.aspx",busyImageUri:"images/spinner_trumba.gif",showDebugOutput:((typeof(trumba_showDebugOutput)!="undefined")&&trumba_showDebugOutput),prologQueue:[],iframeBgColor:"transparent"};(function(){var a=document.getElementsByTagName("script");var f="";var d=false;for(var c=0;c<a.length;c++){var g=a[c].src;if(g&&/msie/i.test(navigator.userAgent)){g=a[c].getAttribute("src",4)}var b=g?g.match(/\/scripts\/(_?spuds|embed)\.js(.*)?$/i):null;if(b){d=("embed"==b[1].toLowerCase());f=b.input.substring(0,b.index+1);f=f.replace(/\/hash[0-9a-f]+\//i,"/");if(f[0]=="/"){f=document.location.protocol+f}break}}$Trumba.baseUri=f;$Trumba.loaderUri=f+$Trumba.loaderUri;$Trumba.busyImageUri=f+$Trumba.busyImageUri;if(typeof(doV3BackCompat)!="undefined"||d){$Trumba.iframeBgColor="transparent"}})();$Trumba.Class={create:function(){return function(){this.initialize.apply(this,arguments)}},extend:function(a,b){for(property in b){a[property]=b[property]}return a},addNamespace:function(n){var parts=n.split(".");var root=window;for(var i=0;i<parts.length;i++){if(root[parts[i]]==null){eval("root."+parts[i]+" = { };")}root=root[parts[i]]}}};$Trumba.Try={these:function(){var c;for(var b=0;b<arguments.length;b++){var a=arguments[b];try{c=a();break}catch(d){}}return c}};$Trumba.$=function(d){var a=[];for(var c=0;c<arguments.length;c++){var b=arguments[c];if(typeof(b)=="string"){b=document.getElementById(b)}a.push(b)}if(a.length==1){return a[0]}return a};Function.prototype.$trumba_bind=function(){var a=this,c=$Trumba.$A(arguments),b=$Trumba.Array.shift(c);return function(){return a.apply(b,c.concat($Trumba.$A(arguments)))}};Function.prototype.$trumba_bindStr=function(){var a=this,d=$Trumba.$A(arguments),c=$Trumba.Array.shift(d);var g=function(){return a.apply(c,d.concat($Trumba.$A(arguments)))};var b="dynCb_"+Math.round(Math.random()*1000000000)+"_cb";window[b]=function(){g()};return b+"()"};$Trumba.Class.addNamespace("$Trumba.Array");$Trumba.Array.shift=function(b){var a=b[0];for(var c=0;c<b.length-1;c++){b[c]=b[c+1]}b.length--;return a};$Trumba.Array.$break={};$Trumba.Array.$continue={};$Trumba.Array.each=function(f,c){var a=0;f=f||[];try{for(var b=0;b<f.length;b++){try{c(f[a],a++)}catch(d){if(d!=$Trumba.Array.$continue){throw d}}}}catch(d){if(d!=$Trumba.Array.$break){throw d}}};$Trumba.$A=function(c){if(!c){return[]}if(c.toArray){return c.toArray()}else{var b=[];for(var a=0;a<c.length;a++){b.push(c[a])}return b}};$Trumba.escape=function(a){return encodeURIComponent(a).replace(new RegExp("\\+","g"),"%2B").replace(new RegExp('\\"',"g"),"%22").replace(new RegExp("\\'","g"),"%27").replace(new RegExp("\\/","g"),"%2F")};$Trumba.Class.addNamespace("$Trumba.String");$Trumba.String={fill:function(f,d){var a=new Array(d);for(var b=0;b<d;b++){a.push(f)}return a.join("")},format:function(){if(arguments.length<=1){return(arguments.length==1)?arguments[0]:""}var a=arguments[0];for(var b=1;b<arguments.length;b++){a=a.replace(new RegExp("\\{"+(b-1)+"}","g"),arguments[b])}return a}};$Trumba.Event={};$Trumba.Class.extend($Trumba.Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement},keyCode:function(a){if(a.charCode){return a.keyCode>0?a.keyCode:a.charCode}return a.keyCode},isAltKey:function(a){return(a.altKey&&a.altKey)||false},isShiftKey:function(a){return(a.shiftKey&&a.shiftKey)||false},isCtrlKey:function(a){return(a.ctrlKey&&a.ctrlKey)||false},isLeftClick:function(a){return(((a.which)&&(a.which==1))||((a.button)&&(a.button==1)))},pointerX:function(a){return;a.pageX||(a.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft))},pointerY:function(a){return;a.pageY||(a.clientY+(document.documentElement.scrollTop||document.body.scrollTop))},stop:function(a){if(a.preventDefault){a.preventDefault();a.stopPropagation()}else{a.returnValue=false;a.cancelBubble=true}},findElement:function(c,b){var a=$Trumba.Event.element(c);while(a.parentNode&&(!a.tagName||(a.tagName.toUpperCase()!=b.toUpperCase()))){a=a.parentNode}return a},observers:false,_observeAndCache:function(d,c,b,a){if(!this.observers){this.observers=[]}if(d.addEventListener){this.observers.push([d,c,b,a]);d.addEventListener(c,b,a)}else{if(d.attachEvent){this.observers.push([d,c,b,a]);d.attachEvent("on"+c,b)}}},unloadCache:function(){if(!$Trumba.Event.observers){return}for(var a=0;a<$Trumba.Event.observers.length;a++){$Trumba.Event.stopObserving.apply(this,$Trumba.Event.observers[a]);$Trumba.Event.observers[a][0]=null}$Trumba.Event.observers=false},observe:function(d,c,b,a){var d=$Trumba.$(d);a=a||false;if(c=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||d.attachEvent)){c="keydown"}this._observeAndCache(d,c,b,a)},stopObserving:function(f,c,b,a){var f=$Trumba.$(f);a=a||false;var g=null;try{g=f.tagName||f.location}catch(d){}if(g){if(c=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||f.detachEvent)){c="keydown"}if(f.removeEventListener){f.removeEventListener(c,b,a)}else{if(f.detachEvent){f.detachEvent("on"+c,b)}}}}});$Trumba.EventSource={_eventSource_events:false,addEventListener:function(b,a){if(b){b=b.toLowerCase()}if(b&&a){if(!this._eventSource_events){this._eventSource_events={}}if(typeof(this._eventSource_events[b])=="undefined"){this._eventSource_events[b]=[]}for(var c=0;c<this._eventSource_events[b].length;c++){if(this._eventSource_events[b][c]==a){return}}this._eventSource_events[b].push(a)}},removeEventListener:function(b,a){if(b){b=b.toLowerCase()}if(b&&a){if(!this._eventSource_events){return}if(typeof(this._eventSource_events[b])=="undefined"){return}var d=[];for(var c=0;c<this._eventSource_events[b].length;c++){if(this._eventSource_events[b][c]!=a){d.push(this._eventSource_events[b][c])}}if(d.length>0){this._eventSource_events[b]=d}else{this._eventSource_events[b]=null;delete this._eventSource_events[b]}}},_fireEvent:function(b){if(b){b=b.toLowerCase()}var a=$Trumba.$A(arguments);a.shift();if(this._eventSource_events[b]){for(var d=0;d<this._eventSource_events[b].length;d++){try{this._eventSource_events[b][d].apply(window,a)}catch(c){}}}}};$Trumba.Logger=$Trumba.Class.create();$Trumba.Logger.LEVEL_ERROR=1;$Trumba.Logger.LEVEL_WARNING=2;$Trumba.Logger.LEVEL_INFO=3;$Trumba.Logger.prototype={initialize:function(){this.handlers=[]},addHandler:function(b){if(b){for(var a=0;a<this.handlers.length;a++){if(this.handlers[a]==b){return}}this.handlers.push(b)}},removeHandler:function(c){if(c&&this.handlers.length>0){var a=[];for(var b=0;b<this.handlers.length;b++){if(this.handlers[b]==c){continue}a[a.length]==this.handlers[b]}this.handlers=a}},_log:function(h,g,f,d,b){if(!this.handlers.length){return}var a={};a.level=h;a.message=g;a.thrown=f;a.className=d;a.methodName=b;for(var c=0;c<this.handlers.length;c++){this.handlers[c].processRecord(a)}},error:function(a){this._log.apply(this,[$Trumba.Logger.LEVEL_ERROR].concat($Trumba.$A(arguments)))},warning:function(a){this._log.apply(this,[$Trumba.Logger.LEVEL_WARNING].concat($Trumba.$A(arguments)))},info:function(a){this._log.apply(this,[$Trumba.Logger.LEVEL_INFO].concat($Trumba.$A(arguments)))}};$Trumba.logger=new $Trumba.Logger();$Trumba.Debug={};$Trumba.Debug.ConsoleLogger=$Trumba.Class.create();$Trumba.Debug.ConsoleLogger.prototype={initialize:function(){if($Trumba.Debug.ConsoleLogger.init){return}if(typeof(console)=="undefined"||typeof(console.log)=="undefined"){return}this._methods={};this._methods[$Trumba.Logger.LEVEL_INFO]=console.log;this._methods[$Trumba.Logger.LEVEL_WARNING]=console.warn||console.log;this._methods[$Trumba.Logger.LEVEL_ERROR]=console.error||console.log;$Trumba.Debug.ConsoleLogger.init=$Trumba.Debug.ConsoleLogger.init||true;$Trumba.logger.addHandler(this)},_getMethod:function(a){return this._methods[a.level]||function(){}},processRecord:function(a){var b="";b=b.length>4?b:"";this._getMethod(a).apply(console,[b+a.message])}};$Trumba.Debug.SpudDebugWindow=$Trumba.Class.create();$Trumba.Debug.SpudDebugWindow.prototype={initialize:function(){this.window=null;if($Trumba.Debug.SpudDebugWindow.instance==null){$Trumba.Debug.SpudDebugWindow.instance=this}$Trumba.logger.addHandler(this);this._tryGetWindow();this.show()},processRecord:function(a){try{this.window.processRecord(a)}catch(b){}},_tryGetWindow:function(){if(this.window){return}try{var a=window.open("","spudDebug","scrollbars=1,status=1,resizable=yes,toolbar=no,menubar=yes");var c;c=a.document;if(typeof(a.processRecord)!="undefined"){this.window=a;$Trumba.logger.info("Attaching to existing debug window.");window.focus()}}catch(b){}},show:function(){if(this.window&&!this.window.closed){return}this.window=null;var a=/msie/i.test(navigator.userAgent);var b=(window.screen.availWidth*0.5)-10;var k=425;var c=a?window.screen.availWidth*0.5+(window.screen.width-window.screen.availWidth):0;var g=window.screen.availHeight-k;var j=null;try{j=window.open("","spudDebug","scrollbars=1,status=1,resizable=yes,width="+b+",height="+k+",left="+c+",top="+g+",toolbar=no,menubar=no");var h;h=j.document;h.write("<html><body>Loading...</body></html>");h.close();j.moveTo(c,g);j.resizeTo(b,k);window.focus()}catch(d){if(j!=null){try{j.close()}catch(f){}j=null}return}this.window=j;this.refresh()},refresh:function(){this.show();if(this.window){var w=this.window;var callbacks={onSuccess:function(result){if(!w.closed){w.document.write(result.body)}w.document.close()},onTimeout:function(){if(!w.closed){w.document.write("Timeout")}w.document.close()},onFailure:function(){if(!w.closed){w.document.write("Fetch error!")}w.document.close()}};var url=$Trumba.loaderUri+"?spud.relpath="+$Trumba.escape("spuddebug.html");if(typeof($Trumba.ScriptXmlHttpRequest)=="undefined"){$Trumba.prologQueue.push(function(){var u=url;var c=callbacks;eval("new $Trumba.ScriptXmlHttpRequest(u, c).invoke();")})}else{new $Trumba.ScriptXmlHttpRequest(url,callbacks).invoke()}}}};$Trumba.Debug.SpudDebugWindow.instance=null;$Trumba.Debug.SpudDebugWindow.keyHandler=function(a){if(!a){a=window.event}var b=String.fromCharCode($Trumba.Event.keyCode(a)).toLowerCase();if(b=="z"&&$Trumba.Event.isAltKey(a)&&$Trumba.Event.isCtrlKey(a)){if($Trumba.Debug.SpudDebugWindow.instance==null){new $Trumba.Debug.SpudDebugWindow()}$Trumba.Debug.SpudDebugWindow.instance.show()}};$Trumba.Event.observe(document,"keypress",$Trumba.Debug.SpudDebugWindow.keyHandler,false);if($Trumba.showDebugOutput){var o=null;if($Trumba.showDebugOutput.console){o=new $Trumba.Debug.ConsoleLogger();if(/Safari/i.test(navigator.userAgent)){o=new $Trumba.Debug.SpudDebugWindow()}}if($Trumba.showDebugOutput.window){o=new $Trumba.Debug.SpudDebugWindow()}if(!o){if(typeof(console)=="undefined"){new $Trumba.Debug.SpudDebugWindow()}else{new $Trumba.Debug.ConsoleLogger()}}}$Trumba.Class.addNamespace("$Trumba.Net");$Trumba.Net.QueryString=$Trumba.Class.create();$Trumba.Net.QueryString.prototype={initialize:function(a){this.pairs=[];if(a!=null){if(typeof(a)=="string"){this.from(a)}else{if(typeof(a)=="object"){this.copyConstructor(a)}}}},copyConstructor:function(a){var b=this;a.visit(function(d,c){b.setAt(d,c)})},from:function(c){this.pairs=[];if(c==null||c==""){return}if(c.indexOf("?")==0){c=c.substring(1)}c=c.split("&");for(var b=0;b<c.length;b++){if(c[b]!=""){var a=c[b].split("=");if(a.length==1){this.pairs.push([decodeURIComponent(a[0]),null])}else{this.pairs.push([decodeURIComponent(a[0]),decodeURIComponent(a[1])])}}}},isEmpty:function(){return this.pairs.length==0},getCount:function(){return this.pairs.length},setAt:function(a,c){var b=this.findByName(a);if(b!=-1){this.pairs[b][1]=c}else{this.pairs.push([a,c])}},toString:function(){var b=new Array(this.pairs.length);for(var a=0;a<b.length;a++){if(this.pairs[a][1]==null){b[a]=$Trumba.escape(this.pairs[a][0])}else{b[a]=$Trumba.escape(this.pairs[a][0])+"="+$Trumba.escape(this.pairs[a][1])}}return b.join("&")},getAt:function(a){if(typeof(a)=="string"){a=this.findByName(a);if(a==-1){return null}}return this.pairs[a]},remove:function(b){var a=this.findByName(b);if(a!=-1){this.removeAt(a)}},removeAt:function(b){var a=[];for(var c=0;c<this.pairs.length;c++){if(c!=b){a.push(this.pairs[c])}}this.pairs=a},length:function(){return this.pairs.length},visit:function(a){for(var b=0;b<this.pairs.length;b++){a(this.pairs[b][0],this.pairs[b].length>1?this.pairs[b][1]:null)}},findByName:function(a){for(var b=0;b<this.pairs.length;b++){if(this.pairs[b][0]==a){return b}}return -1},insert:function(a){for(var b=0;b<a.length();b++){var c=a.getAt(b);this.setAt(c[0],c[1])}},subtract:function(a){for(var b=0;b<a.length();b++){var b=this.findByName(a.getAt(b)[0]);if(b!=-1){this.removeAt(b)}}},prefixWith:function(b){for(var a=0;a<this.pairs.length;a++){this.pairs[a][0]=b+this.pairs[a][0]}}};$Trumba.Net.Url=$Trumba.Class.create();$Trumba.Net.Url.prototype={initialize:function(a){this._path="";this._queryString=new $Trumba.Net.QueryString();this._hash="";if(a!=null){if(typeof(a)=="string"){this.fromString(a)}else{if(a.href){this.fromString(a.href)}else{if(typeof(a)=="object"){this.copyConstructor(search)}}}}},copyConstructor:function(a){this._path=a._path;this._queryString=new $Trumba.Net.QueryString(a._queryString);this._hash=a._hash},fromString:function(a){this._path="";this._queryString=new $Trumba.Net.QueryString();this._hash="";var b=a.indexOf("#");if(b>=0){this._hash=a.substring(b+1);a=a.substring(0,b)}b=a.indexOf("?");if(b>=0){this._queryString=new $Trumba.Net.QueryString(a.substring(b));a=a.substring(0,b)}this._path=a},getPath:function(){return this._path},getHash:function(){return this._hash},getQueryString:function(){return this._queryString},toString:function(){var b=this._path;var a=this._queryString.toString();if(a.length){b+="?"+a}if(this._hash.length){b+="#"+this._hash}return b}};$Trumba.Class.addNamespace("$Trumba.DOM");$Trumba.DOM={createElement:function(a,b){b=b||[];var d=document.createElement(a);for(var c=0;c<b.length;c++){if(b[c][1]!=""){d.setAttribute(b[c][0],b[c][1])}}return d},compareElements:function(d,c){if(d==c){return true}if(!d||!c){return false}if(d.tagName!=c.tagName){return false}if(d.attributes.length!=c.attributes.length){return false}for(var b=0;b<d.attributes.length;b++){var a=d.attributes[b].name;if(c.attributes[a]==null){return false}if(d.attributes[a].value!=c.attributes[a].value){return false}}return true},appendChild:function(c,d){var a=d.getElementsByTagName(c.tagName)||[];for(var b=0;b<a.length;b++){if($Trumba.DOM.compareElements(c,a[b])){return}}d.appendChild(c)}};$Trumba.Class.addNamespace("$Trumba.Spuds");$Trumba.Spuds.nextSpudID=0;$Trumba.Spuds.createSpudId=function(){return"trumba.spud."+$Trumba.Spuds.nextSpudID++};$Trumba.Spuds.supportsLocalStorage=function(){try{return typeof window.localStorage!="undefined"&&typeof window.JSON!="undefined"}catch(a){return false}};$Trumba.addSpud=function(k){var g=k.webName;if(!g||g==""){var d="ERROR : You must provide a webName parameter for your Spud!";alert(d);throw d}delete k.webName;var f=k.spudType;if(!f||f==""){var d="ERROR : You must provide a spudType parameter for your Spud!";alert(d);throw d}if(f.toLowerCase()=="calendar"){f="main"}delete k.spudType;var p=k.spudId;if(p){delete k.spudId}var n=k.url;if(n){delete k.url}var b=k.objectType;if(b){if(!n){n={}}n.objecttype=b}var m=k.detectMobile;if(m!=null){if(!n){n={}}n.detectMobile=m}if(f=="main"&&(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent))){if(!n){n={}}n.ismobile="1"}var j=k;$Trumba.logger.info("Creating "+f+" for calendar "+g,null,"$Trumba","addSpud");var l=p?false:true;if(l){p=$Trumba.Spuds.createSpudId();if(k.position){k.position.removeOnClose=true;var a=document.createElement("div");a.id=p;a.style.position="absolute";a.style.zIndex=100000;a.style.backgroundColor=k.backgroundColor||"transparent";document.body.appendChild(a)}else{var h=$Trumba.String.format($Trumba.Spuds.DIV_FORMAT,p);document.write(h)}}var c=function(){var q=$Trumba.Spuds.SpudFactory.create(g,f,p,n,j);$Trumba.Spuds.controller.addSpud(q)};if($Trumba.$(p)==null){window.setTimeout(function(){if($Trumba.$(p)==null){$Trumba.logger.error("Cannot find our spud div with id "+p,null,null,"$Trumba.addSpud");return}c()},1);return p}c();return p};$Trumba.showWindow=function(a,d,b){var c=window.open(a,d,b);c.focus();return c};$Trumba.Opera8Fixup=function(){window.trumba_opera_8_fix_1=document.getElementById("TrumbaIframe")};$Trumba.addBackCompatSpud=function(a,c,h,d,g){var f=$Trumba.$(g);if(!f){return}f.style.display="none";var b=$Trumba.DOM.createElement("div",[["id",""+Math.random()]]);f.parentNode.insertBefore(b,f);$Trumba.addSpud($Trumba.Class.extend({webName:a,spudType:c,spudId:b.id,url:h},d))};$Trumba.Spuds.IFRAME_FORMAT_SSL='<iframe src="javascript:\'<html><head>{5}</head><body style={4}>&nbsp;</body></html>\'" id="{0}" name="{0}" style="{1}" width="100%" scrolling="no" {2} {3}></iframe>';$Trumba.Spuds.IFRAME_FORMAT='<iframe src="javascript:\'<html><head>{5}</head><body style={4}></body></html>\'" id="{0}" name="{0}" style="{1}" width="100%" scrolling="no" {2} {3}></iframe>';$Trumba.Spuds.DIV_FORMAT='<div id="{0}"></div>';$Trumba.Spuds.handleDocDomain=function(){return(/msie/i.test(navigator.userAgent)&&document.domain!=document.location.hostname)};$Trumba.Spuds.renderIFrameHTML=function(d,c,f,k){k=k||"35";var b=/msie/i.test(navigator.userAgent);var a=window.location.protocol.toLowerCase()==("https:");var j=(b&&a)?$Trumba.Spuds.IFRAME_FORMAT_SSL:$Trumba.Spuds.IFRAME_FORMAT;var g='height="'+k+'" ';if(f){if(typeof(f)=="number"){f=f+"px"}g+='width="'+f+'" '}var h=$Trumba.String.format(j,d,c||"",g,b?' frameborder="no" allowtransparency="yes" ':"","background-color:transparent",$Trumba.Spuds.handleDocDomain()?"<script>window.onload=function(){document.write(\\'<script>document.domain=\\\\\\'"+document.domain+"\\\\\\';<\\\\/script>\\');document.close();};<\/script>":"");return h};$Trumba.Spuds.createIFrame=function(f,d,c,a){var b=document.createElement("iframe");b.setAttribute("id",f);b.setAttribute("name",f);b.setAttribute("width",c||"100%");if(a){b.setAttribute("height",a)}b.setAttribute("scrolling","no");if(d){b.setAttribute("style",d)}return b};$Trumba.Class.addNamespace("$Trumba.Spuds.SpudFactory");$Trumba.Spuds.SpudFactory.create=function(a,b,f,d,c){return new $Trumba.Spuds.SimpleSpud(a,b,f,d,c)};$Trumba.Spuds.removeList={eventid:{},view:{},objectid:{},objecttype:{},key:{}};$Trumba.Spuds.TransientParams={_params:{calendar:{eventid:{},view:{},seriesid:{},parenteventid:{},objectid:{},objecttype:{},key:{}},main:{eventid:{},view:{},seriesid:{},parenteventid:{},objectid:{},objecttype:{},key:{}},mainobject:{eventid:{},view:{},seriesid:{},parenteventid:{},objectid:{},objecttype:{},key:{}},"ryomain.*":{eventid:{},view:{},seriesid:{},parenteventid:{},objectid:{},objecttype:{},key:{}}},getParams:function(a){for(var b in $Trumba.Spuds.TransientParams._params){var c=new RegExp(b,"i");if(c.test(a)){return $Trumba.Spuds.TransientParams._params[b]}}return{}}};$Trumba.Spuds.DivContainer=$Trumba.Class.create();$Trumba.Spuds.DivContainer.prototype={initialize:function(b,a){this._spud=a;this.parentDiv=b;this.id=parentDiv.id},setHTML:function(a,b){this.parentDiv.innerHTML=a},onSpudLoaded:function(){this.resize()},resize:function(){},getWindow:function(){return window},fetch:function(c,b){this.queryString=new $Trumba.Net.QueryString(c);this.queryString.setAt("spud.con","div");b=b||{};var a={onSuccess:this._onDataSuccess.$trumba_bind(this),onTimeout:b.onTimeout||this._onDataTimeout.$trumba_bind(this),onFailure:b.onFailure||this._onDataFailure.$trumba_bind(this)};$Trumba.Spuds.controller.loader.request(this.queryString.toString(),a,{cache:this._spud.getProperty("cache"),id:this.id})},_setErrorHTML:function(){var a='<div style="padding:10px;font-family:Arial;">We\'re sorry, there was an error loading the Spud.</div>';this.setHTML(a)},_onDataSuccess:function(a){this.setHTML(a.body.body);this._fireEvent("onFetched")},_onDataTimeout:function(a){$Trumba.logger.error(this.parentDiv.id+" <b>Timeout Error</b> loading("+this.queryString.toString()+")",null,"$Trumba.Spuds.DivContainer","_onDataTimeout");this._setErrorHTML()},_onDataFailure:function(a){$Trumba.logger.error(this.parentDiv.id+" <b>Data Failure </b> loading("+this.queryString.toString()+")",null,"$Trumba.Spuds.DivContainer","_onDataFailure");this._setErrorHTML()}};$Trumba.Class.extend($Trumba.Spuds.DivContainer.prototype,$Trumba.EventSource);$Trumba.Spuds.IFrameContainer=$Trumba.Class.create();$Trumba.Spuds.IFrameContainer.prototype={initialize:function(b,a){this._spud=a;this.parentDiv=b;this.id=b.id;this.iframeStyle=this._getDefaultStyle();this._position=this._spud.getProperty("position");this._initIFrame();this._loaded=false;if(this._position!=null){this.parentDiv.style.display="";this.parentDiv.style.position="absolute";this.parentDiv.style.left=this._position.left+"px";this.parentDiv.style.top=this._position.top+"px";this.parentDiv.style.width=this._position.width+"px";if(this._position.height){this.parentDiv.style.height=this._position.height+"px"}this.parentDiv.style.overflow="hidden";this.parentDiv.style.zIndex=100000;this.parentDiv.style.backgroundColor=this._spud.getProperty("backgroundColor")||"transparent";if(/msie/i.test(navigator.userAgent)){this.parentDiv.style.visibility="hidden"}else{this.parentDiv.style.height="0px"}}if(navigator.userAgent.indexOf("Gecko")!=-1){this._unloadCallback=this._removeIFrame.$trumba_bind(this);$Trumba.Spuds.controller.addEventListener("unload",this._unloadCallback)}},_initIFrame:function(){var a=this._spud.getProperty("initialHeight")||35;var c="";if(!this._spud.getProperty("position")){c=$Trumba.String.format('<img id="{0}" src="{1}" width="16" height="16" style="width:16px;height:16px;border-width:0;margin:0" alt="Loading"></img>',this._spud._getBusyImageId(),$Trumba.busyImageUri)}var b=$Trumba.String.format('<div id="{0}" style="background-color:transparent;height:{1}px;padding:0px;">{2}</div>',this._getIFrameId(),a,c);this.parentDiv.innerHTML=b;this.iframe=$Trumba.$(this._getIFrameId())},_getDefaultStyle:function(){var a;try{a=this.parentDiv.style.backgroundColor||this.parentDiv.parentNode.style.backgroundColor||$Trumba.iframeBgColor}catch(b){a="transparent"}a=$Trumba.String.format("border-style:none;background-color:{0};",a);return a},close:function(){this.parentDiv.innerHTML="";this.parentDiv.style.display="none";$Trumba.Spuds.controller.removeEventListener("unload",this._unloadCallback);if(this._position!=null&&this._position.removeOnClose){this.parentDiv.parentNode.removeChild(this.parentDiv);this.parentDiv=null}},setHTML:function(b,c){if(c){b=$Trumba.String.format("<html><body>{0}</body></html>",b)}var a={body:b};this._onDataSuccess(a);this._resizeIFrameWithWait(400)},onSpudLoaded:function(){$Trumba.logger.info(this._getIFrameId()+'<span style="color:red"> onSpudLoaded!</span>',null,"$Trumba.Spuds.IFrameContainer","onSpudLoaded");this._loaded=true;this._resizeIFrameWithWait();this._fireEvent("onFetched");this._spudLoaded()},_spudLoaded:function(){},resize:function(){this._resizeIFrame()},scrollIntoView:function(){var f=this.getLocation();if(f.top==0&&f.left==0){return}var a=window.innerHeight||document.documentElement.offsetHeight;var d=document.documentElement.scrollLeft||document.body.scrollLeft;var c=document.documentElement.scrollTop||document.body.scrollTop;var b=f.top-c;if(b>=0&&b<a){return}window.scrollTo(d,f.top)},cumulativeOffset:function(b){var a=0,c=0;do{a+=b.offsetTop||0;c+=b.offsetLeft||0;b=b.offsetParent}while(b);return[c,a]},getLocation:function(){if(this.iframe==null){return{left:0,top:0,width:0,height:0}}var a=this.cumulativeOffset(this.iframe);return{left:a[0],top:a[1],width:this.iframe.offsetWidth,height:this.iframe.offsetHeight}},getScroll:function(){var b={left:0,top:0};if(this.iframe==null){return b}for(var a=this.iframe.parentNode;a!=null&&a!=document.body;a=a.parentNode){b.top+=a.scrollTop||0;b.left+=a.scrollLeft||0}return b},getWindow:function(){if(this.iframe){if(this.iframe.contentWindow){return this.iframe.contentWindow}else{return window.frames[this._getIFrameId()]}}return null},fetch:function(d,c){this.queryString=d;c=c||{};var a=this;var b={onSuccess:this._onDataSuccess.$trumba_bind(this),onTimeout:c.onTimeout||this._onDataTimeout.$trumba_bind(this),onFailure:c.onFailure||this._onDataFailure.$trumba_bind(this),cbid:this.id};this._loaded=false;if(this._spud.getProperty("popupHTML")){b.onSuccess({body:this._spud.getProperty("popupHTML")});return}$Trumba.Spuds.controller.loader.request(this.queryString.toString(),b,{cache:this._spud.getProperty("cache"),id:this.id})},_getIFrameId:function(){return this.id+".iframe"},_resizeIFrameWithWait:function(b){var a=this;b=b||200;window.setTimeout(function(){a._resizeIFrame()},b)},_resizeIFrame:function(){if(!this._loaded||this._spud.closed){return}var f=this.iframe;var b=this;var d=(arguments.length==0);var a=f.height;var g="unk";var c=this._spud.properties.autoWidth;$Trumba.Try.these(function(){g="Moz-"+f.contentDocument.body.offsetHeight;if(!/Safari/i.test(navigator.userAgent)&&f.contentDocument.body.offsetHeight>32000){f.height=32000;f.scrolling="yes"}else{f.height=f.contentDocument.body.offsetHeight}var h=f.contentDocument.getElementById("autoWidthRootDiv");if(c&&h){f.width=h.scrollWidth}else{if(h&&h.offsetWidth>f.offsetWidth){h.style.width=f.offsetWidth+"px"}}},function(){g="IE-"+f.Document.body.scrollHeight;var h=f.Document.body.scrollHeight;if(h!=f.height){f.height=h;if(/msie/i.test(navigator.userAgent)){window.setTimeout(function(){f.style.display="none";f.style.display=""},1)}}if(c&&f.Document.getElementById("autoWidthRootDiv")){var k=f.Document.getElementById("autoWidthRootDiv").scrollWidth;if(k!=f.width){f.width=k;if(/msie/i.test(navigator.userAgent)){window.setTimeout(function(){f.style.display="none";f.style.display=""},1)}}}else{var j=f.Document.getElementById("autoWidthRootDiv");if(j&&j.offsetWidth>f.offsetWidth){j.style.width=f.offsetWidth+"px";j.style.overflowX="scroll"}else{if(j&&j.style.overflowX!="scroll"){j.style.height=(j.offsetHeight+18).toString()+"px";j.style.overflow="hidden";j.style.overflowX="scroll"}}}},function(){g="frames[]-"+frames[f.id].document.body.scrollHeight;f.height=frames[f.id].document.body.scrollHeight;if(c){f.width=frames[f.id].document.body.scrollWidth}},function(){$Trumba.logger.warning(this._getIFrameId()+" Cannot figure out how to set IFRAME height!",null,"$Trumba.Spuds.IFrameContainer","_resizeIFrame");if(d){window.setTimeout(function(){b._resizeIFrame(false)},200)}});if(b._position!=null){b.parentDiv.style.height=f.height+"px";if(b.parentDiv.style.visibility=="hidden"){b.parentDiv.style.visibility="visible"}}this._spud._hideBusyImage();if(f.height!=a){this._sizeChanged()}if(this._position){this._fireEvent("resize",{left:this._position.left,top:this._position.top,width:this._position.width,height:parseInt(f.height)})}this._spud.setSpudCookieProperty("initialHeight",Number(f.height))},_sizeChanged:function(){if(this._position!=null){this.parentDiv.style.overflow="hidden";this.parentDiv.style.width=this._position.width+"px"}else{this.parentDiv.style.overflow="";this.parentDiv.style.width="";this.parentDiv.style.height=""}},getPosition:function(){return this._position},setPosition:function(a){if(!this._position){return}this._position.left=a.left||this._position.left;this._position.top=a.top||this._position.top;this._position.width=a.width||this._position.width;this.parentDiv.style.left=this._position.left+"px";this.parentDiv.style.top=this._position.top+"px";this.parentDiv.style.width=this._position.width+"px"},_removeIFrame:function(){$Trumba.logger.info("<b>_removeIFrame</b> "+this._getIFrameId());var a;if(this.iframe.contentWindow){a=this.iframe.contentWindow.document}else{a=window.frames[this._getIFrameId()].document}a.write("<html><body></body></html>");a.close()},getIFrameDocument:function(a){if(a.contentDocument){return a.contentDocument}else{if(a.contentWindow){return a.contentWindow.document}else{if(a.document){return a.document}}}return null},_setErrorHTML:function(){this.setHTML('<html><body><div style="font-style:italic;font-size:0.8em;font-family:Arial, Helvetica, Verdana;padding:10px;">Calendar is temporarily unavailable.</div></body></html>',false)},_rebuildIFrame:function(c){if(this._spud.closed){$Trumba.logger.warning(this._getIFrameId()+"("+this.queryString.toString()+") Spud Closed - Not Rebuilding");return}var a=this.iframe.offsetHeight;var b=a;var d=this._spud.getProperty("initialHeight");if((a==0)&&(d!=null)){b=d}this.parentDiv.style.overflow="hidden";this.parentDiv.style.height=b+"px";if(this.iframe&&this.iframe.parentNode){this.parentDiv.removeChild(this.iframe)}this.iframe=null;this.parentDiv.innerHTML=$Trumba.Spuds.renderIFrameHTML(this._getIFrameId(),this.iframeStyle,null,a);this.iframe=$Trumba.$(this._getIFrameId());if($Trumba.Spuds.handleDocDomain()){this.html=c.replace("{{document.domain}}",document.domain);window.setTimeout(this._populateIFrame.$trumba_bind(this),1)}else{this.html=c;this._populateIFrame()}},_populateIFrame:function(){if(this.iframe.contentWindow){var c=this.iframe.contentWindow.document;this._writeAndClose(c,this.html);this._resizeIFrameWithWait()}else{if(window.frames){var d=this._getIFrameId();var a=this;var b=function(){if(!frames[d]){window.setTimeout(arguments.callee,1);return}a._writeAndClose(frames[d].document,this.html);a._resizeIFrameWithWait()};window.setTimeout(b,1)}else{$Trumba.logger.error("Ugh - no frames support, how did we get here?")}}},_setProfile:function(a){this._spud.profile=a},_onDataSuccess:function(a){this._setProfile(a.profile);this._rebuildIFrame(a.body);return},_onDataTimeout:function(a){$Trumba.logger.error(this._getIFrameId()+" <b>Timeout Error</b> loading("+this.queryString.toString()+")");this._setErrorHTML()},_onDataFailure:function(a){$Trumba.logger.error(this._getIFrameId()+" <b>Data Failure </b> loading("+this.queryString.toString()+")");this._setErrorHTML()},_writeAndClose:function(b,a){this._spud._hideBusyImage();b.write(a);b.close()}};$Trumba.Class.extend($Trumba.Spuds.IFrameContainer.prototype,$Trumba.EventSource);$Trumba.Spuds.SimpleSpud=$Trumba.Class.create();$Trumba.Spuds.SimpleSpud.prototype={initialize:function(a,b,g,f,c){f=f||{};this.spudType=b;this.spudConfig=c.spudConfig||"";this.spudConfigSuffix=(this.spudConfig==""?"":("_"+this.spudConfig));this.id=g;this.webName=a;this._initProperties(c,f);this.setQueryString(this._getEmbedArguments(),f);this.firstFetch=true;this.parentDiv=$Trumba.$(g);try{this.parentDiv.innerHTML="<div></div>"}catch(d){this._fixDivInsideInline()}if(true===this.getProperty("divContainer")){this.container=new $Trumba.Spuds.DivContainer(this.parentDiv,this)}else{this.container=new $Trumba.Spuds.IFrameContainer(this.parentDiv,this)}this.container.addEventListener("onFetched",this.onFetched.$trumba_bind(this));if(this.getProperty("position")!=null){new $Trumba.Spuds.PopUpBehavior(this,this.getProperty("closeOnFocus"),this.getProperty("closeOnFocus"))}$Trumba.logger.info(this.getUniqueID()+" Created for "+a+"/"+b+" "+this.queryString.toString())},getSavedSpudProperties:function(d){var b={};var g=d+"_";var a=g.length;try{var f=window.localStorage.getItem("spudProperties_"+this.webName);if(f){var c=window.JSON.parse(f);for(var j in c){if(j.indexOf(g)==0){b[j.substring(a)]=c[j]}}}}catch(h){}return b},_initProperties:function(b,c){this.properties=b||{};var d;var a;if($Trumba.Spuds.supportsLocalStorage()){d=this.getSavedSpudProperties(this.spudType+this.spudConfigSuffix);$Trumba.Class.extend(this.properties,d)}if(c.objecttype){this.properties.ignoreCookie=true}if(c.preview){this.properties.ignoreCookie=true}if(this.getProperty("ignoreCookie")){return}if($Trumba.Spuds.supportsLocalStorage()){d=this.getSavedSpudProperties("*"+this.spudConfigSuffix);for(var f in d){if(0==f.indexOf("url.")){c[f.substring(4)]=d[f]}else{this.properties[f]=d[f]}}}},getPermalink:function(){var c=this.container.getWindow();if(c){var b=c.document;if(b){var a=b.getElementById("permaLink");if(a&&a.href){return a.href}}}return window.top.location.href},getEventSummary:function(){var a=this.container.getWindow();if(a&&a.eventSummary){return a.eventSummary}return null},setTitle:function(a){if(typeof(this.container.iframe)!="undefined"&&this.container.iframe!=null){this.container.iframe.setAttribute("title",a)}},setSpudCookieProperty:function(a,d){var c=/^url\./i.test(a)?"*":this.spudType+this.spudConfigSuffix;if($Trumba.Spuds.supportsLocalStorage()){try{var b=JSON.parse(window.localStorage.getItem("spudProperties_"+this.webName));if(b==null){b={}}b[c+"_"+a]=d;window.localStorage.setItem("spudProperties_"+this.webName,window.JSON.stringify(b))}catch(f){}}},close:function(){if(this.closed){$Trumba.logger.info("ALREADY CLOSED:"+this.queryString.toString());return}$Trumba.logger.info("Closing Spud:"+this.queryString.toString());this._hideBusyImage();this.closed=true;this._fireEvent("close");this.container.close();$Trumba.Spuds.controller.removeSpud(this)},_fixDivInsideInline:function(){$Trumba.logger.warning("Spud container embedded in a "+this.parentDiv.parentNode.tagName.toUpperCase(),null,"$Trumba.Spuds.SimpleSpud","_fixDivInsideInline");var b=$Trumba.DOM.createElement("div",[["id",""+Math.random()]]);var c=this.parentDiv.parentNode;var a=false;while(!a&&c){var d=c.parentNode.insertBefore(b,c.nextSibling);try{d.innerHTML="<div></div>";a=true}catch(f){if(/BODY/i.test(c.tagName)){c==null}else{c=c.parentNode}}}if(!a){var g="We're sorry but you have placed your Trumba Spud inside of a "+c.tagName.toUpperCase()+" element which is not supported.  You must place it inside of a DIV.";alert(g);throw g}this.id=b.id;this.parentDiv=$Trumba.$(this.id)},onFetched:function(){var a=false;var h=this.container.getWindow();var g=h?h.document:null;if(h&&h.trumba_addStyleRules){var j=this.getProperty("styleRules");if(j&&j.length){h.trumba_addStyleRules(j);a=true}}if(h&&g){var f=this.getProperty("styleSheets");if(f&&f.length){var c=g.getElementsByTagName("head")[0];for(var b=0;b<f.length;b++){var d=g.createElement("link");d.setAttribute("href",f[b]);d.setAttribute("rel","stylesheet");c.appendChild(d)}g.body.style.visibility="visible"}}if(a){this.resize()}},onSpudLoaded:function(){this.container.onSpudLoaded()},_getEmbedArguments:function(){var c=new $Trumba.Net.QueryString(location.search);var a=c.getAt("trumbaEmbed");if(a==null||a.length==1){try{if(window.top.location.search!=location.search){c=new $Trumba.Net.QueryString(window.top.location.search);a=c.getAt("trumbaEmbed");if(a==null||a.length==1){return null}}else{return null}}catch(d){return null}}if(a[1]=="view=event"){var b=c.getAt("eventid");if(b!=null&&a.length>1){a[1]+="&eventid="+b[1]}}return new $Trumba.Net.QueryString(a[1])},getProperty:function(b){var a=this.properties[b];if(typeof(a)=="undefined"){a=null}return a},setProperty:function(a,b){this.properties[a]=b},getIFrameId:function(){if(this.container._getIFrameId){return this.container._getIFrameId()}return window.name},resize:function(){this.container.resize()},getQueryString:function(){return this.queryString.toString()},setQueryString:function(d,c){var a;if(c!=null){if(this.getProperty("lateAdd")){a=new $Trumba.Net.QueryString(d);for(var b in c){a.setAt(b,c[b])}}else{a=new $Trumba.Net.QueryString();for(var b in c){a.setAt(b,c[b])}a.insert(new $Trumba.Net.QueryString(d))}}else{a=new $Trumba.Net.QueryString(d)}a.setAt("calendar",this.webName);a.setAt("widget",this.spudType);if(this.spudConfig==""){a.removeAt("spudConfig",this.spudConfig)}else{a.setAt("spudConfig",this.spudConfig)}this.queryString=a},refresh:function(){this._fetchHTML()},navigate:function(b,p,m){var q=m;m=this.getProperty(m);if(p){$Trumba.logger.info(this.getUniqueID()+" abs navigate("+b+")");window.top.location.href=b}else{if(m&&m.length){$Trumba.logger.info(this.getUniqueID()+" base navigate("+m+" -- "+b+")");var f=this.queryString;this._mergeQueryString(b,true);var d=new $Trumba.Net.Url(m);var h=this.getProperty("openInNewWindow");if("detailBase"==q&&!h){var g=null;try{g=window.top.location.href}catch(n){}if(g){var a=new $Trumba.Net.QueryString(b);var k=new $Trumba.Net.Url(window.top.location);a.setAt("returnUrl",k.toString());b=a.toString()}}if(b!=""){d.getQueryString().setAt("trumbaEmbed",b)}if(h){var c=this.getProperty("closeWindowOnReturn");if(c==null||c=="true"||c==true){d.getQueryString().setAt("winClose","1")}try{var j=window.open(d.toString(),"trumbaNewWin");j.focus()}catch(n){}}else{try{window.top.location.href=d.toString()}catch(l){window.top.location=d.toString()}}}else{$Trumba.logger.info(this.getUniqueID()+" rel navigate("+b+")");this.ignoreNav=true;$Trumba.Spuds.controller._navigate(b);if(this.closed){return}this._fetchHTML(new $Trumba.Net.QueryString(b),true);$Trumba.Spuds.controller.historyIndex=this.queryHistory.length-1;if(this.getProperty("scrollTopOnNav")){window.scrollTo(0,0)}}}},getUniqueID:function(){return"("+this.id+"-"+this.spudType+")"},onNavigate:function(a){$Trumba.logger.info(this.getUniqueID()+" onNavigate("+a+")");if(this.getProperty("closeOnNav")){this.close();return}if(this.ignoreNav){this.ignoreNav=false;return}this._fetchHTML(a,false)},onNavigateBack:function(){this._navigate(this.removeHistoryQueryString(),false)},onNavigateHistory:function(a){this._navigate(this.getHistoryQueryString(a),true)},_navigate:function(a,b){if(a!=null){var c=this._compareQueryString(a);this.setQueryString(a);if(!c){this._fetchHTML(null,false,b)}}},_mergeQueryString:function(h,u,f){u=u||false;f=f||false;var x=new $Trumba.Net.QueryString(this.queryString);var w=new $Trumba.Net.QueryString(h);var k=$Trumba.Spuds.TransientParams.getParams(this.spudType);if(!f){var j=[];if(k!=null){x.visit(function(a){if(k[a]){j.push(a)}})}for(var s=0;s<j.length;s++){x.remove(j[s])}}for(var s=0;s<w.length();s++){var v=w.getAt(s);var z=(v[0].charAt(0)=="-")||(($Trumba.Spuds.removeList[v[0]]!=null&&!u)&&(k==null||k[v[0]]==null));if(z){if(v[0].charAt(0)=="-"){x.remove(v[0].substring(1))}else{x.remove(v[0])}}else{x.setAt(v[0],v[1])}}var c=w.getAt("objecttype");if(!c){var p=this.getProperty("objectType");if(p){x.setAt("objecttype",p)}}var t=new $Trumba.Net.QueryString(this.queryString);this.setQueryString(x);x=t;w=new $Trumba.Net.QueryString(this.queryString);var l={};for(var s=0;s<x.length();s++){var A=x.getAt(s);var g=w.findByName(A[0]);var y=g!=-1?w.getAt(g):null;if(y!=null){var m;if(this.spudType=="datefinder"&&A[0]=="date"){m=A[1].substring(0,6)==y[1].substring(0,6)||A[1]=="99901230"||A[1]=="99901231"}else{m=A[1]==y[1]}if(!m){l[A[0]]={from:A[1],to:y[1]}}}else{l[A[0]]={from:A[1],to:null}}w.removeAt(g)}for(var s=0;s<w.length();s++){var y=w.getAt(s);if(this.spudType=="datefinder"&&y[0]=="date"&&(this.pageDate.substring(0,6)==y[1].substring(0,6)||y[1]=="99901230"||y[1]=="99901231")){continue}l[y[0]]={from:null,to:y[1]}}var r=false;l.widget=null;delete l.widget;if(typeof(this.argList)!="undefined"){r=true;for(var q in l){if(typeof(this.argList[q])!="undefined"){r=false;if(!u){var d=l[q];this._fireEvent("onArgumentChanged",{name:q,oldValue:d.from,newValue:d.to})}}}}else{if(!u){for(var q in l){var d=l[q];this._fireEvent("onArgumentChanged",{name:q,oldValue:d.from,newValue:d.to})}}}return r},_compareQueryString:function(b){if(!b.pairs){return false}if(typeof(this.argList)!="undefined"){for(var a in this.argList){var d=this.queryString.getAt(a);var c=b.getAt(a);d=d==null?"":d[1];c=c==null?"":c[1];if(d!=c){return false}}return true}return false},addHistoryQueryString:function(g,a,b){a=a||false;b=b||false;if(!this.queryHistory){this.queryHistory=[]}if(!b){var f=$Trumba.Spuds.controller;if(typeof(f.historyIndex)!="undefined"&&(f.historyIndex+1)<this.queryHistory.length){this.queryHistory.length=f.historyIndex+1}this.queryHistory.push(new $Trumba.Net.QueryString(g));var d="/?i="+(this.queryHistory.length-1).toString();if(f.supportsHistory&&!a&&d!=SWFAddress.getValue()){SWFAddress.setValue(d)}}},removeHistoryQueryString:function(){if(this.queryHistory&&this.queryHistory.length>0){this.queryHistory.pop();return this.queryHistory.pop()}return null},getHistoryQueryString:function(a){if(this.queryHistory&&this.queryHistory.length>a){return this.queryHistory[a]}return null},_fetchHTML:function(a,m,j){m=m||false;j=j||false;var f=this.firstFetch;if(this.firstFetch){this.firstFetch=false}else{if(a){var h=this._mergeQueryString(a,false,m);if(this.getProperty("noAsyncNav")){var n=new $Trumba.Net.QueryString(window.location.search);n.setAt("trumbaEmbed",this.getQueryString());window.location.search="?"+n.toString()}if(h){this.addHistoryQueryString(this.queryString,f,j);return}}}this.addHistoryQueryString(this.queryString,f,j);var g=new $Trumba.Net.QueryString(this.queryString);var c=this.getProperty("styleSheets");if(c&&c.length){g.setAt("ssOverrides",1)}var l=this.getProperty("navigateHandler");if(!f&&l&&typeof l=="function"){if(l(g,m)){return}}var k=this.getProperty("position");if(this.container._loaded||k!=null){if(k!=null){this._showBusyImage(k)}else{var d=this.container.getLocation();var b=this.getProperty("busyImageOffsetTop");if(b){d.top+=b;this.setProperty("busyImageOffsetTop",null)}this._showBusyImage(d)}}this.container.fetch(g)},_setLoadingHTML:function(){var a="";try{if(this.parentDiv.currentStyle){var d=this.parentDiv;while(d&&d.currentStyle){a=d.currentStyle.backgroundColor;if(a=="transparent"){d=d.parentNode}else{break}}}else{if(window.getComputedStyle){a=window.getComputedStyle(this.parentDiv,null).backgroundColor}}}catch(c){$Trumba.logger.error("RIP getting background color!",c,"$Trumba.Spuds.SimpleSpud","_setLoadingHTML")}if(a.length){a=$Trumba.String.format("background-color:{0};",a)}var b=$Trumba.String.format('<div style="{0}margin:0px;padding:0px;font-size:0.8em;font-family:Arial, Helvetica, Verdana;font-style:italic;"><img src="',a)+$Trumba.baseUri+'images/spinner.gif" width="16" height="16" style="width:16px;height:16px;border-width:0;margin:0">&nbsp;&nbsp;Loading&nbsp;.&nbsp;.&nbsp;.</div>';this.container.setHTML(b,true);this.container.resize()},_getBusyImageId:function(){return this.id+".busy"},_showBusyImage:function(c){var b=this.getProperty("hideBusyImage")||false;if(!b){var a=$Trumba.DOM.createElement("img",[["id",this._getBusyImageId()]]);a.style.position="absolute";a.style.left=c.left+"px";a.style.top=c.top+"px";a.style.width="16px";a.style.height="16px";a.style.borderWidth="0";a.style.margin="0";a.style.zIndex=100000;a.src=$Trumba.busyImageUri;document.body.appendChild(a);$Trumba.logger.info(this._getBusyImageId()+", parent:"+a.parentNode.tagName,null,"$Trumba.Spuds.SimpleSpud","_showBusyImage")}},_hideBusyImage:function(){var a=$Trumba.$(this._getBusyImageId());if(a){$Trumba.logger.info(this._getBusyImageId()+", parent:"+a.parentNode.tagName,null,"$Trumba.Spuds.SimpleSpud","_hideBusyImage");a.parentNode.removeChild(a)}}};$Trumba.Class.extend($Trumba.Spuds.SimpleSpud.prototype,$Trumba.EventSource);$Trumba.Spuds.PopUpBehavior=$Trumba.Class.create();$Trumba.Spuds.PopUpBehavior.prototype={initialize:function(a,f,b){this._spud=a;if(f){this._makeKeyHandler(window.document);var c=$Trumba.Spuds.controller.getSpuds();for(var d=0;d<c.length;d++){this._makeKeyHandler(c[d].container.getWindow().document)}}if(b){this._makeClickHandler(window.document);var c=$Trumba.Spuds.controller.getSpuds();for(var d=0;d<c.length;d++){if(c[d]==a){continue}this._makeClickHandler(c[d].container.getWindow().document)}}},_makeKeyHandler:function(a){this._makeHandler(a,"keypress",function(b){if($Trumba.Event.keyCode(b)==$Trumba.Event.KEY_ESC){this.spud.close();this.stop(true)}},false)},_makeClickHandler:function(a){this._makeHandler(a,"click",function(b){this.spud.close();this.stopObserving()},false)},_makeHandler:function(f,d,b,a){var c=$Trumba.$A(arguments);c.shift();c.shift();c.shift();c.shift();var g={onEvent:function(h){this._event=h||window.event;c=[];c.push(this._event);return this.observer.apply(this,c.concat(this.args))},stop:function(h){$Trumba.Event.stop(this._event);if(h){this.stopObserving()}},stopObserving:function(){$Trumba.Event.stopObserving(this.element,this.name,this.boundObserver,this.capture)},element:f,name:d,observer:b,capture:a,boundObserver:null,args:c};this._spud.addEventListener("close",g.stopObserving.$trumba_bind(g));g.spud=this._spud;g.boundObserver=g.onEvent.$trumba_bind(g);$Trumba.Event.observe(g.element,g.name,g.boundObserver,g.capture)}};$Trumba.Spuds.Cache=$Trumba.Class.create();$Trumba.Spuds.Cache.prototype={initialize:function(a){this._cache={};this._lifetime=a>=0?a:(10*60*1000)},empty:function(){this._cache={}},getItem:function(a){var b=this._cache[a];if(b){if(b.expires>new Date()){return b.value}this.removeItem(a)}return null},addItem:function(a,b){this._cache[a]={expires:new Date()-0+this._lifetime,value:b}},removeItem:function(a){if(this._cache[a]){this._cache[a]=null;delete this._cache[a]}}};$Trumba.Spuds.Loader=$Trumba.Class.create();$Trumba.Spuds.Loader.prototype={initialize:function(){this._nextDomain=0;this._domains=["","a.","b.","c."];this._domainMap={};this._cache=new $Trumba.Spuds.Cache(10*60*1000);this._requests={}},_queueRequest:function(b,a){if(a.replace&&b.id){var c=this._requests[b.id];if(c){$Trumba.logger.info("Replacing pending request for Spud "+b.id);c.cancel();this._removeFromQueue(b.id)}}if(b.delay<=0){b.execute();return}if(b.id){$Trumba.logger.info("Queueing request for Spud "+b.id);this._requests[b.id]=b;b.onComplete=this._removeFromQueue.$trumba_bind(this,b.id)}},_removeFromQueue:function(a){$Trumba.logger.info("Removing request for Spud "+a);this._requests[a]=null;delete this._requests[a]},_setDomain:function(b){var a=/http:\/\/(qa|webstage|dev|www)\.trumba\.com/i.exec(b);if(!a){a=/http:\/\/(www)\.addtomycalendar\.com/i.exec(b)}if(!a){a=/http:\/\/(qatrumbaweb)\.unival\.com/i.exec(b)}if(!a){return b}var c=new RegExp("//"+a[1]+".","i");b=b.replace(c,"//"+this._domains[this._nextDomain]+a[1]+".");this._nextDomain++;this._nextDomain%=this._domains.length;return b},_getSpudUrl:function(b){var a;if(b.indexOf("preview=")!=-1){a=$Trumba.loaderUri}else{a=this._domainMap[b];if(!a){a=this._setDomain($Trumba.loaderUri);this._domainMap[b]=a}}return a+"?"+b},_onSuccess:function(c,b,a){$Trumba.logger.info("Caching "+c);this._cache.addItem(c,a);b(a)},request:function(h,d,c){c=$Trumba.Class.extend({id:null,replace:true,delay:0.001,cache:false},c||{});var b=this._getSpudUrl(h);$Trumba.logger.info("Loading "+b,null,"$Trumba.Spuds.Loader","request");if(c.cache){var g=this._domainMap[h];var f=this._cache.getItem(h);if(g&&f){$Trumba.logger.info("CACHE HIT : "+h);d.onSuccess(f);return}if(g){var a=d.onSuccess;d.onSuccess=this._onSuccess.$trumba_bind(this,h,a)}}this._queueRequest(new $Trumba.Spuds.Loader.Request(b,d,c),c)}};$Trumba.Spuds.Loader.Request=$Trumba.Class.create();$Trumba.Spuds.Loader.Request.prototype={initialize:function(b,c,a){this._oldOnSuccess=c.onSuccess;c.onSuccess=this._onSuccess.$trumba_bind(this);this.id=a.id;this._url=b;this._callbacks=c;this._cancelled=false;if(a.delay>0){this._timer=window.setTimeout(this.execute.$trumba_bind(this),a.delay*1000)}},_onSuccess:function(){if(this._cancelled){$Trumba.logger.warning("Ignoring Dead Spud Request "+this.id);return}$Trumba.logger.warning("Data Received for Spud Request "+this.id);if(this.onComplete){this.onComplete()}this._oldOnSuccess.apply(this,arguments)},cancel:function(){$Trumba.logger.warning("Cancelling Spud Request "+this.id);this._cancelled=true;window.clearTimeout(this._timer)},execute:function(){if(this._cancelled){return}$Trumba.logger.info("Executing Spud Request "+this.id);var a=new $Trumba.ScriptXmlHttpRequest(this._url,this._callbacks);a.invoke()}};$Trumba.Spuds.PageController=$Trumba.Class.create();$Trumba.Spuds.PageController.prototype={initialize:function(){this.spuds={};this.historyIndex=0;this.loader=new $Trumba.Spuds.Loader();$Trumba.Event.observe(window,"unload",this.onPageUnload.$trumba_bind(this),false);var a=this;$Trumba.Event.observe(window,"resize",function(){a.resize()},false);if(/msie/i.test(navigator.userAgent)&&(typeof(window.opera)=="undefined")){this.resizeTimeoutTicks=0;this.resizeTimeoutId=window.setInterval(this.onResizeTimeout.$trumba_bind(this),1000)}},getHostWindow:function(){return window},getSpudById:function(a){return this.spuds[a]},addHead:function(a,b){var c=document.getElementsByTagName("head");if(c.length){var d=$Trumba.DOM.createElement(a,b);$Trumba.DOM.appendChild(d,c[0])}},onResizeTimeout:function(){this.resizeTimeoutTicks++;if(this.resizeTimeoutTicks>15){$Trumba.logger.info("Killing timer.");window.clearInterval(this.resizeTimeoutId);this.resizeTimeoutId=null;return}this.resize()},onPageUnload:function(){if(this.resizeTimeoutId!=null){window.clearInterval(this.resizeTimeoutId);this.resizeTimeoutId=null}$Trumba.Event.unloadCache();this._fireEvent("unload")},_navigate:function(a){if(typeof(a)=="string"){a=new $Trumba.Net.QueryString(a)}this._fireEvent("navigate",a);for(var b in this.spuds){if(this.spuds[b].onNavigate){this.spuds[b].onNavigate(a)}}},navigate:function(a){this._navigate(a);for(var b in this.spuds){this.historyIndex=this.spuds[b].queryHistory.length-1;break}},navigateBack:function(){if(window.location.hash==""||window.location.hash=="#"){var b=new $Trumba.Net.QueryString(window.location.search);if(b.getAt("winClose")){try{window.opener.focus()}catch(d){}try{window.close()}catch(d){}return}var a=b.getAt("trumbaEmbed");if(a&&a[1]){b=new $Trumba.Net.QueryString(a[1]);a=b.getAt("returnUrl")}if(a&&a[1]){try{SWFAddress.back()}catch(d){window.top.location.href=a[1]}return}}if(this.historyIndex==0){$Trumba.Spuds.controller.navigate("-view=&-eventid=&-parenteventid=&-seriesid=&-objectid=&-childview=")}else{if(this.supportsHistory){SWFAddress.back()}else{for(var c in this.spuds){if(this.spuds[c].onNavigateBack){this.spuds[c].onNavigateBack()}}}}},navigateHistory:function(b){if(b){this.historyIndex=parseInt(b.parameters.i||"0");for(var a in this.spuds){if(this.spuds[a].onNavigateHistory){this.spuds[a].onNavigateHistory(this.historyIndex)}}}},checkSupportsHistory:function(){var c=(typeof trumbaUsingSubmitHash!="undefined"&&trumbaUsingSubmitHash);var b=(typeof document.documentMode!="undefined"&&document.documentMode>=8);var a=(typeof TrumbaDisableBrowserHistory!="undefined"&&TrumbaDisableBroswerHistory);var d=$Trumba.Spuds.handleDocDomain()&&asual.util.Browser.isMSIE()&&asual.util.Browser.getVersion()<8;this.supportsHistory=(window.location.hash==""||window.location.hash=="#"||/#??\/\?i=\d+/.test(window.location.hash))&&!c&&!b&&!a&&!d;if(this.supportsHistory){try{SWFAddress.addEventListener(SWFAddressEvent.EXTERNAL_CHANGE,function(g){$Trumba.Spuds.controller.navigateHistory(g)})}catch(f){this.supportsHistory=false}}if(!this.supportsHistory){SWFAddress.disable()}},disableHistory:function(){SWFAddress.disable();this.supportsHistory=false},addSpud:function(a){if(this.spuds[a.id]==null){this.spuds[a.id]=a;a.refresh()}},removeSpud:function(a){if(this.spuds[a.id]!=null){this.spuds[a.id]=null;delete this.spuds[a.id]}},getSpud:function(a){for(var b in this.spuds){if(this.spuds[b].getIFrameId&&this.spuds[b].getIFrameId()==a){return this.spuds[b]}}return null},getSpuds:function(){var a=[];for(var b in this.spuds){if(this.spuds[b].getIFrameId){a.push(this.spuds[b])}}return a},refresh:function(){for(var a in this.spuds){if(this.spuds[a].refresh){this.spuds[a].refresh()}}},resize:function(){var a=0;for(var b in this.spuds){if(this.spuds[b].resize){this.spuds[b].resize()}}},findSpud:function(f,d){var b=this.getSpuds();for(var c=0;c<b.length;c++){var a=b[c].getProperty(f);if(a&&a==d){return b[c]}}return null},promptForPassword:function(b){$Trumba.logger.error("Prompting!");var a=this;$Trumba.Event.observe(window,"focus",function(){$Trumba.logger.error("Focus!");$Trumba.Event.stopObserving(window,"focus",arguments.callee,false);a.refresh()},false);window.open(b,"trumba_embedLogin","width=750,height=325,scrollbars=1,status=1,resizable=yes,toolbar=no,menubar=no")}};$Trumba.Class.extend($Trumba.Spuds.PageController.prototype,$Trumba.EventSource);$Trumba.Spuds.controller=new $Trumba.Spuds.PageController();$Trumba.Spuds.controller.baseUri=$Trumba.baseUri;function SizeTrumbaFrame(a){}$Trumba.ScriptXmlHttpRequest=$Trumba.Class.create();$Trumba.ScriptXmlHttpRequest.prototype={initialize:function(b,a){this.options=a||{};this.options.timeout=this.options.timeout||60;this.cbid=a.cbid||$Trumba.ScriptXmlHttpRequest.createCBID();this.url=b;var c=(/\?/.test(this.url)?"&":"?");this.srcUrl=this.url+c+"srpc.cbid="+this.cbid+"&srpc.get=true"},invoke:function(){window.setTimeout(this.onAsyncInvoke.$trumba_bind(this),1)},onAsyncInvoke:function(){try{this.doGet()}catch(a){(this.options.onFailure||$Trumba.emptyFunction)(a)}},doGet:function(){this.script=document.createElement("script");this.script.setAttribute("type","text/javascript");$Trumba.ScriptXmlHttpRequest.addCallback(this.cbid,this.srcUrl,this.onComplete.$trumba_bind(this));this.timeoutID=window.setTimeout(this.onTimeout.$trumba_bind(this),this.options.timeout*1000);this.script.setAttribute("src",this.srcUrl);var a;a=document.getElementsByTagName("head")[0];a.appendChild(this.script)},cleanup:function(){if(this.script.parentNode!=null){this.script.parentNode.removeChild(this.script)}},onTimeout:function(){this.cleanup();(this.options.onTimeout||$Trumba.emptyFunction)()},onComplete:function(b){window.clearTimeout(this.timeoutID);var c=this.cleanup.$trumba_bind(this);var d=b;var a=(this.options.onSuccess||$Trumba.emptyFunction);window.setTimeout(function(){c();a(d)},1)}};if(/(Safari\/)(\d+)/i.test(navigator.userAgent)&&parseFloat(/(Safari\/)(\d+)/i.exec(navigator.userAgent)[2])<=312){$Trumba.Class.extend($Trumba.ScriptXmlHttpRequest.prototype,{cleanup:function(){this.innerIFRAME.parentNode.removeChild(this.innerIFRAME)},doGet:function(){var a='<html><head><script type="text/javascript">\r\nwindow["$Trumba"] = { };\r\n$Trumba["ScriptXmlHttpRequest"] = { };\r\n$Trumba.ScriptXmlHttpRequest.requestComplete = function(result) {window.parent.$Trumba.ScriptXmlHttpRequest.requestComplete(result); }\r\ndocument.write(\'<s\'+\'cript type="text/javascript" src="'+this.srcUrl+"\"><'+'/script>');\r\n<\/script>\r\n</head>\r\n<body></body>\r\n</html>\r\n";var c=this;var b=function(){if(document.body==null){window.setTimeout(arguments.callee.$trumba_bind(this),100);return}$Trumba.ScriptXmlHttpRequest.addCallback(c.cbid,c.srcUrl,c.onComplete.$trumba_bind(c));c.timeoutID=window.setTimeout(c.onTimeout.$trumba_bind(c),c.options.timeout*1000);var d=$Trumba.Spuds.createIFrame(c.cbid=".iframe","width:0px;height:0px;visibility:hidden;border-style:none;");c.innerIFRAME=document.body.appendChild(d);var f;if(c.innerIFRAME.contentWindow){f=c.innerIFRAME.contentWindow.document}else{f=window.frames[c.innerIFRAME.name].document}f.write(a);f.close()};b()}})}$Trumba.Class.extend($Trumba.ScriptXmlHttpRequest,{rpcID:0,rpcGUID:""+Math.random(),callbacks:{},requestComplete:function(result){result=eval(result);var cb=$Trumba.ScriptXmlHttpRequest.getCallback(result.cbid,result.url);if(cb==null){$Trumba.logger.error("No callback found for result "+result.cbid+":"+result.url,null,null,"$Trumba.ScriptXmlHttpRequest.requestComplete");return}$Trumba.ScriptXmlHttpRequest._removeCallback(result.cbid,result.url);cb(result)},getCallback:function(c,b){var d=c+":"+b;var a=this.callbacks[d];if(a&&typeof(a.queue)!="undefined"){$Trumba.logger.info("Found "+a.length+" callbacks.");return a[0]}return a},addCallback:function(c,b,a){var d=c+":"+b;if(this.callbacks[d]){if(typeof(this.callbacks[d].queue)=="undefined"){this.callbacks[d]=[this.callbacks[d],a];this.callbacks[d].queue=true}else{this.callbacks[d].push(a)}return}this.callbacks[d]=a},_removeCallback:function(b,a){var c=b+":"+a;if(this.callbacks[c]){if(this.callbacks[c].queue){$Trumba.Array.shift(this.callbacks[c]);if(this.callbacks[c].length==0){delete this.callbacks[c]}return}this.callbacks[c]=null;delete this.callbacks[c]}},createCBID:function(){var a=this.rpcGUID;a+="-"+this.rpcID++;return a}});$Trumba.PostXmlHttpRequest=$Trumba.Class.create();$Trumba.PostXmlHttpRequest.prototype={initialize:function(b,a,c){this.options=a||{};this.options.timeout=this.options.timeout||60;this.postdata=c;this.cbid=$Trumba.ScriptXmlHttpRequest.createCBID();this.url=b;var d=(/\?/.test(this.url)?"&":"?");this.srcUrl=this.url+d+"srpc.cbid="+this.cbid+"&srpc.post=true"},invoke:function(){window.setTimeout(this.onAsyncInvoke.$trumba_bind(this),1)},onAsyncInvoke:function(){try{this.doPost();this.doGet()}catch(a){(this.options.onFailure||$Trumba.emptyFunction)(a)}},getIFrameDocument:function(a){if(a.contentDocument){return a.contentDocument}else{if(a.contentWindow){return a.contentWindow.document}else{if(a.document){return a.document}}}return null},doPost:function(){this.iframe=document.createElement("iframe");var f="cbirame"+this.cbid;this.iframe.setAttribute("id",f);this.iframe.style.border="0px";this.iframe.style.width="0px";this.iframe.style.height="0px";this.iframe=document.body.appendChild(this.iframe);var d=this.getIFrameDocument(this.iframe);d.write('<html><body><form method="post"></form></body></html>');var b=d.getElementsByTagName("form")[0];b.action=this.srcUrl;for(var c in this.postdata){var a=d.createElement("input");a.name=c;a.type="hidden";a.value=this.postdata[c];b.appendChild(a)}this.timeoutID=window.setTimeout(this.onTimeout.$trumba_bind(this),(this.options.timeout||15)*1000);$Trumba.ScriptXmlHttpRequest.addCallback(this.cbid,this.srcUrl,this.onComplete.$trumba_bind(this));b.submit()},curDelay:0,delays:[1,1,2,3,5,8,13,21,34,55,89,144],doGet:function(){var b={onSuccess:this.getOnSuccess.$trumba_bind(this),onFailure:this.getOnFailure.$trumba_bind(this),onTimeout:this.onTimeout.$trumba_bind(this),timeout:this.options.timeout};var a=this.url+"&srpc.origcbid="+this.cbid;var c=new $Trumba.ScriptXmlHttpRequest(a,b,null);c.invoke()},getOnFailure:function(){(this.options.onFailure||$Trumba.emptyFunction())()},getOnSuccess:function(result){if(result==null){if(this.timedOut){return}window.setTimeout(this.doGet.$trumba_bind(this),this.delays[this.curDelay++]*1000);return}eval(result)},cleanup:function(){if(typeof(this.iframe)!="undefined"){this.iframe.parentNode.removeChild(this.iframe)}},onTimeout:function(){window.clearTimeout(this.timeoutID);this.timedOut=true;this.cleanup();(this.options.onTimeout||$Trumba.emptyFunction)()},onComplete:function(b){window.clearTimeout(this.timeoutID);var c=this.cleanup.$trumba_bind(this);var d=b;var a=(this.options.onSuccess||$Trumba.emptyFunction);window.setTimeout(function(){c();a(d)},1)}};if(typeof(trumba_preSpudsJS)!="undefined"){$Trumba.logger.warning($Trumba.String.format("spuds.js took {0} seconds to download.",($Trumba.loadTime-trumba_preSpudsJS)/1000))}for(var i=0;i<$Trumba.prologQueue.length;i++){$Trumba.prologQueue[i]()}$Trumba.prologQueue=[];$Trumba.Spuds.controller.checkSupportsHistory()};